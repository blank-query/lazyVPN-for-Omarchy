#!/bin/bash

# Toggle automatic failover to fastest server on reconnection failure

# Source common functions
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/lazyvpn-common" || exit 1
# shellcheck source=./lazyvpn-common

CONFIG_DIR="$HOME/.config/lazyvpn"
CONFIG_FILE="$CONFIG_DIR/config"

# Load current config
load_config "$CONFIG_FILE"

# Toggle the setting
if [[ "${AUTO_FAILOVER:-false}" == "true" ]]; then
  NEW_VALUE="false"
else
  NEW_VALUE="true"
fi

# Update config atomically
if ! atomic_config_update "AUTO_FAILOVER" "$NEW_VALUE" "$CONFIG_FILE"; then
  error "Failed to update config"
  exit 1
fi
